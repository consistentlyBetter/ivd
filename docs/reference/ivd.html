<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Main function to set up and run parallel MCMC using nimble and future. ivd computes a mixed effects location and scale model with Spike and Slab regularization on the scale random effects. — ivd • ivd</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Main function to set up and run parallel MCMC using nimble and future. ivd computes a mixed effects location and scale model with Spike and Slab regularization on the scale random effects. — ivd"><meta name="description" content="Main function to set up and run parallel MCMC using nimble and future.
ivd computes a mixed effects location and scale model with Spike and Slab regularization
on the scale random effects."><meta property="og:description" content="Main function to set up and run parallel MCMC using nimble and future.
ivd computes a mixed effects location and scale model with Spike and Slab regularization
on the scale random effects."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ivd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../getting-started.html">Getting started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/consistentlyBetter/ivd/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Main function to set up and run parallel MCMC using nimble and future. <code>ivd</code> computes a mixed effects location and scale model with Spike and Slab regularization on the scale random effects.</h1>
      <small class="dont-index">Source: <a href="https://github.com/consistentlyBetter/ivd/blob/HEAD/R/ivd.R" class="external-link"><code>R/ivd.R</code></a></small>
      <div class="d-none name"><code>ivd.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Main function to set up and run parallel MCMC using nimble and future.
<code>ivd</code> computes a mixed effects location and scale model with Spike and Slab regularization
on the scale random effects.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ivd</span><span class="op">(</span></span>
<span>  <span class="va">location_formula</span>,</span>
<span>  <span class="va">scale_formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">niter</span>,</span>
<span>  nburnin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  WAIC <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  n_eff <span class="op">=</span> <span class="st">"local"</span>,</span>
<span>  ss_prior_p <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-location-formula">location_formula<a class="anchor" aria-label="anchor" href="#arg-location-formula"></a></dt>
<dd><p>A formula for the location model</p></dd>


<dt id="arg-scale-formula">scale_formula<a class="anchor" aria-label="anchor" href="#arg-scale-formula"></a></dt>
<dd><p>A formula for the scale model</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame in long format for analysis</p></dd>


<dt id="arg-niter">niter<a class="anchor" aria-label="anchor" href="#arg-niter"></a></dt>
<dd><p>Total number of MCMC iterations after burnin</p></dd>


<dt id="arg-nburnin">nburnin<a class="anchor" aria-label="anchor" href="#arg-nburnin"></a></dt>
<dd><p>Number of burnin iterations, defaults to the same as niter</p></dd>


<dt id="arg-waic">WAIC<a class="anchor" aria-label="anchor" href="#arg-waic"></a></dt>
<dd><p>Compute WAIC, defaults to 'TRUE'</p></dd>


<dt id="arg-workers">workers<a class="anchor" aria-label="anchor" href="#arg-workers"></a></dt>
<dd><p>Number of parallel R processes – doubles as 'chains' argument</p></dd>


<dt id="arg-n-eff">n_eff<a class="anchor" aria-label="anchor" href="#arg-n-eff"></a></dt>
<dd><p>Use stan::monitor function or built local: 'stan' vs. 'local'</p></dd>


<dt id="arg-ss-prior-p">ss_prior_p<a class="anchor" aria-label="anchor" href="#arg-ss-prior-p"></a></dt>
<dd><p>Prior inclusion probability. Defaults to '.5'.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Currently not used</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"ivd"</code> (and <code>"list"</code>), which contains the
results from fitting a mixed-effects location-scale model with Spike-and-Slab
regularization using NIMBLE and parallel MCMC sampling.</p>
<p>The returned object is a named list with the following components:</p><ul><li><p><code>samples</code>: An <code>mcmc.list</code> object containing posterior
samples for all monitored parameters across all chains.</p></li>
<li><p><code>logLik_array</code>: A 3D array of pointwise log-likelihood
values with dimensions <code>iterations × chains × N</code>.</p></li>
<li><p><code>rhat_values</code>: Vector of split-\(\hat{R}\) convergence
diagnostics (Vehtari et al., 2021).</p></li>
<li><p><code>n_eff</code>: Vector of effective sample sizes, either computed
internally ("local") or via <code><a href="https://mc-stan.org/rstan/reference/monitor.html" class="external-link">rstan::monitor()</a></code> ("stan").</p></li>
<li><p><code>nimble_constants</code>: List of model constants used by the
underlying NIMBLE model (e.g., number of groups, number of parameters).</p></li>
<li><p><code>X_location_names</code>, <code>Z_location_names</code>:
Names of fixed and random effects in the location submodel.</p></li>
<li><p><code>X_scale</code>, <code>Z_scale</code>:
Matrices used for the scale submodel’s fixed and random effects.</p></li>
<li><p><code>Y</code>: Data frame with the response vector and group identifiers.</p></li>
<li><p><code>workers</code>: Number of parallel chains used.</p></li>
<li><p><code>...</code>: Additional elements created internally and used for
downstream S3 methods (<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, etc.).</p></li>
</ul><p>The object is designed to support S3 methods for printing, summarizing,
and extracting results from the <code>ivd</code> model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">ivd</span><span class="op">(</span>location_formula <span class="op">=</span> <span class="va">math_proficiency</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">school_id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   scale_formula <span class="op">=</span>  <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">school_id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>   data <span class="op">=</span> <span class="va">saeb</span>,</span></span>
<span class="r-in"><span>   niter <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>   nburnin <span class="op">=</span> <span class="fl">2000</span>,</span></span>
<span class="r-in"><span>   WAIC <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>   workers <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">## Workers = 1 for CRAN server - not ideal for individual use</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> nimble version 1.3.0 is loaded.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> For more information on NIMBLE and a User Manual,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> please visit https://R-nimble.org.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Note for advanced users who have written their own MCMC samplers:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   As of version 0.13.0, NIMBLE's protocol for handling posterior</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   predictive nodes has changed in a way that could affect user-defined</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   samplers in some situations. Please see Section 15.5.1 of the User Manual.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===== Monitors =====</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> thin = 1: Ustar, beta, sigma_rand, ss, z, zeta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===== Samplers =====</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> conjugate sampler (1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - beta[]  (1 element)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> binary sampler (320)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - ss[]  (320 elements)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RW_lkj_corr_cholesky sampler (1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - Ustar[1:2, 1:2] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RW sampler (323)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - z[]  (320 elements)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - zeta[]  (1 element)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - sigma_rand[]  (2 elements)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> thin = 1: R, beta, mu, sigma_rand, ss, tau, u, zeta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |-------------|-------------|-------------|-------------|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |-------------------------------------------------------|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [Warning] There are 7 individual pWAIC values that are greater than 0.4. This may indicate that the WAIC estimate is unstable (Vehtari et al., 2017), at least in cases without grouping of data nodes or multivariate data nodes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Defining model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Setting data and initial values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'X' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'X_scale' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'Z_scale' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running calculate on model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] Any error reports that follow may simply reflect missing values in model variables.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking model sizes and dimensions</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] This model is not fully initialized. This is not an error.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          To see which variables are not initialized, use model$initializeInfo().</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>          For more information on model initialization, see help(modelInitialization).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Compiling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] This may take a minute.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Compiling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] This may take a minute.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] Use 'showCompilerOutput = TRUE' to see C++ compilation details.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'X' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'X_scale' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   [Note] 'Z_scale' is provided in 'data' but is not a variable in the model and is being ignored.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> running chain 1...</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some R-hat values are greater than 1.10 -- increase warmup and/or sampling iterations.</span>
<span class="r-in"><span><span class="co">## Posterior inclusion probability plot (PIP)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"pip"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ivd-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## PIP vs. Within-cluster SD</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span>  <span class="st">"funnel"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ivd-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## Diagnostic plots based on coda plots:</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="codaplot.html">codaplot</a></span><span class="op">(</span><span class="va">out</span>, parameters <span class="op">=</span>  <span class="st">"Intc"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ivd-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="codaplot.html">codaplot</a></span><span class="op">(</span><span class="va">out</span>, parameters <span class="op">=</span>  <span class="st">"R[scl_Intc, Intc]"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="ivd-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Philippe Rast, Marwin Carmo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

