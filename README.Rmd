---
output: github_document
bibliography: inst/ref.bib
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- knit with rmarkdown::render("README.Rmd", output_format = "md_document") -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  cache = FALSE
)
```

# Individual Variance Detection


<!-- badges: start -->
[![R-CMD-check](https://github.com/ph-rast/ivd/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/ph-rast/ivd/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/consistentlyBetter/ivd/graph/badge.svg?token=SD0PM5BVIL)](https://codecov.io/gh/consistentlyBetter/ivd)
<!-- badges: end -->

*ivd* is an R package for random effects selection in the scale part of Mixed Effects Location Scale Modlels (MELSM). `ivd()` fits a random intercepts model with a spike-and-slab prior on the random effects of the scale.

## Installation

This package can be installed with 

``` r
# install.packages("devtools")
devtools::install_github("consistentlybetter/ivd")
```

## Example


```{r example}
library(ivd)

d <- mlmRev::Hsb82

## Ensure that school id is a continuous vector
school_dat$schoolid <- NA
k <- 0
for( i in unique(school_dat$school) ) {
  k <- k+1
  school_dat[school_dat$school == i, "schoolid"] <- k
}
```

## Estimate Model
```{r}
out <- ivd(location_formula = mAch ~ ses + sector + (ses | schoolid),
           scale_formula =  ~ ses + (1 | schoolid),
           data = school_dat,
           niter = 1000, nburnin = 2000)
```

```{r}
summary(out)
```

```{r}
plot(out, type = "pip" )
```

```{r}
plot(out, type =  "funnel")
```

Diagnostic plots based on coda plots:
```{r}
codaplot(out, parameter =  "beta[1]")
codaplot(out, parameter =  "R[2, 1]")
```

# References
